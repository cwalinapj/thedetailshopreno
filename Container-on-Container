Container-on-Container Experiment Architecture (v1.0)

This is the minimum structure that enables:
	•	one container = one experiment page
	•	lineage preservation
	•	reversible traffic changes
	•	LLM-driven iteration
	•	S3-backed memory
	•	zero access to the client’s real site

⸻

1. Core Concept (Lock This Mentally)

You never modify the client’s site. Ever.

Instead:
	•	Client site = immutable reference
	•	You create proxy experiment containers
	•	You send traffic only to your containers
	•	Containers evolve, not the client

Think of it like Git, but for websites + traffic.

2. High-Level Runtime Topology

                 ┌────────────────────┐
                 │  Client Website     │
                 │  (read-only input)  │
                 └─────────┬──────────┘
                           │ scrape / fetch
                           ▼
┌────────────────────────────────────────────────────┐
│ ORIGIN OS                                          │
│                                                    │
│  ┌──────────────┐    ┌──────────────┐             │
│  │ Experiment A │◀───│ Experiment B │◀─── lineage │
│  │ Container    │    │ Container    │             │
│  └──────┬───────┘    └──────┬───────┘             │
│         │ traffic                  │               │
│         ▼                          ▼               │
│   AdWords / Social           AdWords / Social      │
│                                                    │
│  Metrics → S3 → Memory → LLM → Next Container      │
└────────────────────────────────────────────────────┘

3. Docker Architecture (Critical)

3.1 Base Images (DO NOT SKIP THIS)

You must separate build logic from experiment logic.

Base Image (immutable)

origin-base-web
├── node:20-alpine
├── nginx
├── playwright (for rendering)
├── curl
├── python (for LLM tooling)
└── no secrets

This image:
	•	never changes
	•	is used by all experiment containers
	•	keeps environments consistent (scientific validity)

⸻

3.2 Experiment Container (one per variant)

Each experiment is its own container.
origin-exp-<site>-<variant>-<timestamp>

Examples:

origin-exp-supremex-v1-20251222
origin-exp-supremex-v2-cta-test
origin-exp-supremex-v3-layout

4. Canonical Repo Structure (LLM-Friendly)

This is what the LLM actually sees and works with.

origin-os/
├── docker/
│   ├── base/
│   │   └── Dockerfile
│   ├── experiment/
│   │   └── Dockerfile
│   └── reverse-proxy/
│       └── Dockerfile
│
├── experiments/
│   └── supremexdetail/
│       ├── baseline/
│       │   ├── snapshot.json
│       │   ├── scrape.html
│       │   └── metadata.yaml
│       │
│       ├── exp_001/
│       │   ├── container/
│       │   │   ├── Dockerfile
│       │   │   ├── nginx.conf
│       │   │   └── app/
│       │   │       ├── index.html
│       │   │       ├── styles.css
│       │   │       └── app.js
│       │   ├── changes.yaml
│       │   ├── hypothesis.yaml
│       │   └── lineage.yaml
│       │
│       ├── exp_002/
│       │   └── ...
│       │
│       └── traffic/
│           ├── routing.yaml
│           └── spend_limits.yaml
│
├── llm/
│   ├── prompts/
│   │   ├── container_builder.md
│   │   ├── change_generator.md
│   │   └── postmortem.md
│   ├── schemas/
│   │   ├── experiment.yaml
│   │   └── change.yaml
│   └── orchestrator.py
│
├── metrics/
│   └── supremexdetail/
│       ├── exp_001/
│       │   ├── raw.json
│       │   └── summary.yaml
│       └── exp_002/
│
└── memory/
    ├── lessons.md
    ├── patterns.md
    └── failed_ideas.md

5. What the LLM Is Allowed To Do

The LLM never:
	•	touches the client site
	•	edits production infra
	•	controls ad spend directly

The LLM can:
	•	clone a baseline snapshot
	•	propose a new experiment container
	•	change HTML/CSS/CTA/layout
	•	generate hypotheses
	•	read metrics
	•	suggest next variant

⸻

6. Container Build Flow (Step-By-Step)

Step 1 — Baseline Capture (Once)
render_site --url https://supremexdetail.com \
            --out experiments/supremexdetail/baseline/

Stored forever.
Never overwritten.

⸻

Step 2 — LLM Proposes Experiment

llm/change_generator.md produces:
experiment_id: exp_001
goal: increase_booking_clicks
change:
  type: cta
  before: "Book Now"
  after: "Get Your Free Ceramic Quote"
reasoning: "Reduces commitment friction"

Step 3 — Container Builder

LLM runs against container_builder.md:
	•	copies baseline files
	•	applies change
	•	builds new container directory
	•	writes lineage.yaml

parent: baseline
changeset: exp_001
timestamp: 2025-12-22T12:10Z

Step 4 - Build Container

docker build -t origin-exp-supremex-exp001 ./experiments/supremexdetail/exp_001/container
docker run -d -p 8081:80 origin-exp-supremex-exp001

Step 5 — Traffic Routing (Controlled)

Traffic goes only here:

ads → experiment container → metrics

Never to the client site.

⸻

7. Metrics & Memory (Why This Is Powerful)

Each container writes:

{
  "experiment": "exp_001",
  "impressions": 1240,
  "clicks": 43,
  "conversion_proxy": 3.47,
  "date_range": "2025-12-22 → 2025-12-24"
}

Stored in:

metrics/supremexdetail/exp_001/raw.json

LLM later synthesizes:

lesson:
  change_type: CTA
  effect: positive
  confidence: high
  reuse: allowed

Written to:

memory/patterns.md

8. Why Long-Lived Containers Are OK (You’re Right)

You do not destroy containers.

You:
	•	freeze them
	•	label them
	•	stop traffic

Why?

Because:
	•	traffic behavior is part of the experiment
	•	future models learn better from full lineage
	•	you avoid “overfitting to recent wins”

This mirrors scientific reproducibility, not SaaS churn.

⸻

9. The LLM’s Mental Model (This Matters)

To the LLM:
	•	baseline = ground truth
	•	container = hypothesis
	•	traffic = stimulus
	•	metrics = outcome
	•	memory = learning

That’s why this works.

⸻

10. Why This Beats Traditional A/B Tools

Traditional Tools
Origin OS
Hidden logic
Full lineage
Platform-owned data
Your S3
Limited variants
Infinite
Vendor lock-in
Sovereign
No learning memory
Compounding intelligence

Final Lock Statement

This design lets you:
	•	sell experiments, not promises
	•	keep legal risk near zero
	•	let LLMs iterate safely
	•	turn marketing into a learning asset
